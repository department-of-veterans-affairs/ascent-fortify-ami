# Jenkins Fortify Slave Module
This folder contains a [Terraform](https://www.terraform.io/) module that can be used to deploy a Jenkins Slave Instance that runs [Fortify SCA and its various apps](https://software.microfocus.com/en-us/products/static-code-analysis-sast/overview). This module is designed to deploy an [Amazon Machine Image (AMI)](https://docs.aws.amazon.com/AWSEC2/latest/UserGuide/AMIs.html) that had Fortify SCA and apps installed via the [packer scripts](https://github.com/department-of-veterans-affairs/ascent-fortify-ami/tree/master/packer) in this project.

## How do you use this module?
This folder defines a [Terraform module](https://www.terraform.io/docs/modules/usage.html), which you can use in your code by adding a module configuration and setting its source parameter to URL of this folder:

```
module "jenkins_fortify_agent" {
  # Use version 1.0 of the jenkins-fortify-slave module
  source                       = "github.com/department-of-veterans-affairs/ascent-fortify-ami.git//modules/jenkins-fortify-slave?ref=v1.0"

  # ... see the rest of the required variables in variables.tf
}
```

Note the following parameter:

source: Use this parameter to specify the URL of the jenkins-fortify-slave module. The double slash (//) is intentional and required. Terraform uses it to specify subfolders within a Git repo (see module sources). The ref parameter specifies a specific Git tag in this repo. That way, instead of using the latest version of this module from the master branch, which will change every time you run Terraform, you're using a fixed version of the repo.

You can find the other parameters in variables.tf

## Prerequisites
Make sure that you already have an AMI generated by the scripts in the packer folder in the root of this project.


## What this module does
This terraform module registers itself with an existing Jenkins master server, and is ready for running Fortify scans on (assumed as part of jenkins jobs). After running module, you can define this node in your jenkins pipeline in the following way...
```java
node('fortify-agent') {
  // do some cool fortify scanning
}
```
Assuming you are using an AMI generated in the packer folder at the root of the project....

You can use the following tools without a full path, as they are added to the instance's `$PATH` variable:
- fortifyclient
- scapostinstall
- fortifyupdate
- FPRUtility
- sourceanalyzer
- ReportGenerator

The following packages are already installed on the server:
- tomcat
- java
- FortifySCA
- maven
- fortify-maven-plugin
